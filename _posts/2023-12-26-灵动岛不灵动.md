---
layout: post
title: 灵动岛如何灵动
date: 2023-12-26 18:06 +0800
categories: [开发]
tags: [编程]
---

近期在唯品会APP上做了几个灵动岛（实时活动）与业务结合的尝试

第一次尝试将订单待支付提醒与灵动岛结合：当用户下单后，APP创建一个待支付灵动岛提醒用户回到APP支付，当订单被支付或者取消、过期再销毁灵动岛。

后面将唯品会特有的购物车倒计时与灵动岛结合，当用户加购后，将购物车锁库存的倒计时以灵动岛的形式展示出来。

还接入了物流系统，做待取件信息的提示，虽然这个确实有点鸡肋，但ld还是让我做，说是汇报时多一种样式。



做了几次灵动岛的开发需求后，总结出以下几点Tips

- 在灵动岛上展示网络图
  - 创建灵动岛之后，无法进行网络请求，对应的我们也就不能进行网络图下载，那如何才能在灵动岛上展示网络图片呢，答案是，在创建灵动岛时将图片以data的形式塞入创建所需的attribute里，在视图层将其转为image

- 统计灵动岛的点击数据
  - 怎么样看有多少用户点击了灵动岛，这里的统计方式有很多，我使用的是将点击事件与主项目内的外部唤醒协议结合，在URL上加入标识参数，跳转到站内时在路由层配合统一的基建上报埋点

- 避免完全依赖PUSH对灵动岛进行更新
  - 灵动岛的Token是推送更新的关键，每个灵动岛都有专属的Token，用来定点推送，但是Token的获取是异步的，平均耗时1.25秒左右。这意味着无法在灵动岛创建之后立刻推送更新，当用户操作间隔很短时，例如创建订单到支付订单，应当尽量在客户端就处理灵动岛更新。

